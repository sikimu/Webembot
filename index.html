<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="icon" href="data:">
<title>Webembot</title>
<style>
  .uuid-table {
    border-collapse: collapse;
    width: 100%;
    max-width: 800px;
    margin: 20px 0;
  }
  .uuid-table th, .uuid-table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }
  .uuid-table th {
    background-color: #f5f5f5;
  }
  .uuid-info {
    display: none;
    margin: 20px 0;
  }
  .uuid-info.visible {
    display: block;
  }
</style>
</head><body>
<h1>Webembot</h1>

Webembot is a library for controlling <a href=https://www.embot.jp/>embot</a> over Bluetooth. (<a href="uuids.html">Bluetooth UUIDs一覧</a>)<br>
<br>

<button id=btnstart>デバイスに接続</button>
<button id="btnShowUuids" disabled>Show UUIDs</button><br>

<div id="uuidInfo" class="uuid-info">
  <h2>接続中のデバイスのUUID情報</h2>
  <table class="uuid-table">
    <thead>
      <tr>
        <th>Short UUID</th>
        <th>Full UUID</th>
        <th>Properties</th>
        <th>現在の値</th>
      </tr>
    </thead>
    <tbody id="uuidTableBody">
    </tbody>
  </table>
</div>

<script type="module">
import { Webembot } from "./Webembot.js";

let currentDevice = null;

btnstart.onclick = async () => {
  const emb = await Webembot.create();
  currentDevice = emb;
  btnShowUuids.disabled = false;
};

btnShowUuids.onclick = async () => {
  if (!currentDevice) {
    alert('デバイスが接続されていません。');
    return;
  }

  try {
    const characteristics = await currentDevice.getCharacteristicsInfo();
    const tableBody = document.getElementById('uuidTableBody');
    tableBody.innerHTML = '';

    characteristics.forEach(ch => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${ch.shortUuid}</td>
        <td>${ch.uuid}</td>
        <td>${ch.properties}</td>
        <td>${ch.value}</td>
      `;
      tableBody.appendChild(row);
    });

    document.getElementById('uuidInfo').classList.add('visible');

    // 値を定期的に更新（読み取り可能な特性のみ）
    setInterval(async () => {
      try {
        const updatedCharacteristics = await currentDevice.getCharacteristicsInfo();
        const rows = tableBody.getElementsByTagName('tr');
        updatedCharacteristics.forEach((ch, index) => {
          if (rows[index]) {
            rows[index].cells[3].textContent = ch.value;
          }
        });
      } catch (error) {
        console.error('UUID値の更新に失敗しました:', error);
      }
    }, 1000);
  } catch (error) {
    console.error('UUID情報の取得に失敗しました:', error);
    alert('UUID情報の取得に失敗しました。');
  }
};
</script>

<hr>
<a href=https://github.com/code4fukui/Webembot/>src on GitHub</a>

</body>
</html>
